<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Zest React Authentication - Complete Flow Documentation</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family:
          -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        line-height: 1.7;
        color: #2c3e50;
        background: #ffffff;
        padding: 0;
      }

      /* Minimal Header */
      .header {
        background: #1eba68;
        color: white;
        padding: 6px 20px;
        text-align: center;
        position: sticky;
        top: 0;
        z-index: 1000;
        font-size: 0.85em;
      }

      /* Search */
      .search {
        max-width: 1200px;
        margin: 10px auto;
        padding: 0 20px;
      }

      .search input {
        width: 100%;
        padding: 10px 15px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 0.95em;
      }

      .search input:focus {
        outline: none;
        border-color: #1eba68;
      }

      /* Main Layout */
      .wrapper {
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
        display: flex;
        gap: 30px;
      }

      /* Sidebar */
      .sidebar {
        width: 250px;
        flex-shrink: 0;
        background: #f8f9fa;
        border: 1px solid #e9ecef;
        border-radius: 4px;
        padding: 15px;
        position: sticky;
        top: 60px;
        max-height: calc(100vh - 80px);
        overflow-y: auto;
      }

      .sidebar h3 {
        font-size: 0.95em;
        margin-bottom: 12px;
        color: #495057;
        font-weight: 600;
        padding-bottom: 8px;
        border-bottom: 1px solid #dee2e6;
      }

      .sidebar ul {
        list-style: none;
      }

      .sidebar li {
        margin: 4px 0;
      }

      .sidebar a {
        display: block;
        padding: 6px 10px;
        color: #495057;
        text-decoration: none;
        font-size: 0.85em;
        border-radius: 3px;
      }

      .sidebar a:hover {
        background: #e9ecef;
      }

      .sidebar a.active {
        background: #1eba68;
        color: white;
      }

      /* Content */
      .content {
        flex: 1;
        min-width: 0;
      }

      section {
        margin-bottom: 50px;
        scroll-margin-top: 60px;
      }

      h2 {
        font-size: 1.6em;
        margin: 40px 0 20px 0;
        padding-bottom: 10px;
        border-bottom: 2px solid #1eba68;
        color: #212529;
        font-weight: 600;
      }

      h3 {
        font-size: 1.3em;
        margin: 30px 0 15px 0;
        color: #212529;
        font-weight: 600;
      }

      h4 {
        font-size: 1.1em;
        margin: 20px 0 10px 0;
        color: #495057;
        font-weight: 600;
      }

      h5 {
        font-size: 1em;
        margin: 15px 0 8px 0;
        color: #6c757d;
        font-weight: 600;
      }

      p {
        margin: 12px 0;
        color: #495057;
      }

      /* Boxes */
      .box {
        background: #f8f9fa;
        border: 1px solid #e9ecef;
        border-radius: 4px;
        padding: 20px;
        margin: 20px 0;
      }

      .step {
        background: #ffffff;
        border-left: 3px solid #1eba68;
        padding: 15px;
        margin: 15px 0;
      }

      .step-num {
        display: inline-block;
        background: #1eba68;
        color: white;
        width: 24px;
        height: 24px;
        border-radius: 50%;
        text-align: center;
        line-height: 24px;
        font-size: 0.85em;
        font-weight: 600;
        margin-right: 10px;
      }

      /* Lists */
      ul,
      ol {
        margin: 12px 0;
        padding-left: 25px;
      }

      li {
        margin: 6px 0;
        color: #495057;
      }

      /* Code */
      code {
        background: #f1f3f5;
        padding: 2px 6px;
        border-radius: 3px;
        font-family: "Courier New", monospace;
        font-size: 0.9em;
        color: #1eba68;
      }

      .code-block {
        background: #f8f9fa;
        border: 1px solid #e9ecef;
        border-radius: 4px;
        padding: 15px;
        margin: 15px 0;
        overflow-x: auto;
        font-family: "Courier New", monospace;
        font-size: 0.85em;
        line-height: 1.6;
      }

      /* Tables */
      table {
        width: 100%;
        border-collapse: collapse;
        margin: 20px 0;
        background: white;
        border: 1px solid #dee2e6;
      }

      table th {
        background: #1eba68;
        color: white;
        padding: 12px;
        text-align: left;
        font-weight: 600;
        font-size: 0.9em;
      }

      table td {
        padding: 12px;
        border-bottom: 1px solid #e9ecef;
        font-size: 0.9em;
      }

      table tr:last-child td {
        border-bottom: none;
      }

      table tr:hover {
        background: #f8f9fa;
      }

      /* Alerts */
      .info,
      .success,
      .warning,
      .error {
        padding: 15px;
        margin: 15px 0;
        border-left: 4px solid;
        border-radius: 4px;
      }

      .info {
        background: #e7f3ff;
        border-color: #2196f3;
      }

      .success {
        background: #e8f5e9;
        border-color: #4caf50;
      }

      .warning {
        background: #fff3e0;
        border-color: #ff9800;
      }

      .error {
        background: #ffebee;
        border-color: #f44336;
      }

      /* Badges */
      .badge {
        display: inline-block;
        padding: 3px 8px;
        border-radius: 3px;
        font-size: 0.75em;
        font-weight: 600;
        margin-left: 8px;
      }

      .badge-success {
        background: #4caf50;
        color: white;
      }

      /* Scroll to top */
      .scroll-top {
        position: fixed;
        bottom: 20px;
        right: 20px;
        width: 40px;
        height: 40px;
        background: #1eba68;
        color: white;
        border: none;
        border-radius: 50%;
        cursor: pointer;
        display: none;
        align-items: center;
        justify-content: center;
        font-size: 1.2em;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
      }

      .scroll-top.visible {
        display: flex;
      }

      .scroll-top:hover {
        background: #033418;
      }

      /* Responsive */
      @media (max-width: 1024px) {
        .wrapper {
          flex-direction: column;
        }
        .sidebar {
          width: 100%;
          position: relative;
          top: 0;
          max-height: none;
        }
      }
    </style>
  </head>
  <body>
    <div class="header">
      <h1>Zest React Authentication</h1>
    </div>

    <div class="search">
      <input type="text" id="search" placeholder="Search documentation..." />
    </div>

    <div class="wrapper">
      <div class="sidebar">
        <h3>Table of Contents</h3>
        <ul id="toc">
          <li><a href="#overview">System Overview</a></li>
          <li><a href="#architecture">Architecture</a></li>
          <li><a href="#entry-points">Entry Points</a></li>
          <li><a href="#main-flow">Main Flow</a></li>
          <li><a href="#complete-flow">Complete Codebase Flow</a></li>
          <li><a href="#mobile-entry">Mobile Entry</a></li>
          <li><a href="#otp-flow">OTP Flow</a></li>
          <li><a href="#email-flow">Email Flow</a></li>
          <li><a href="#props-methods">Props & Methods</a></li>
          <li><a href="#utilities">Utilities</a></li>
          <li><a href="#error-handling">Error Handling</a></li>
          <li><a href="#api-calls">API Calls</a></li>
          <li><a href="#session-storage">Session Storage</a></li>
          <li><a href="#components">Components</a></li>
          <li><a href="#visual-flows">Visual Flows</a></li>
          <li><a href="#edge-cases">Edge Cases</a></li>
          <li><a href="#tracking">Tracking Events</a></li>
          <li><a href="#summary">Summary</a></li>
        </ul>
      </div>

      <div class="content">
        <!-- 1. SYSTEM OVERVIEW -->
        <section id="overview">
          <h2>1. System Overview</h2>

          <div class="box">
            <h4>Document Purpose</h4>
            <p>
              This comprehensive documentation covers
              <strong>every single aspect</strong> of the Zest React
              Authentication application. It includes:
            </p>
            <ul>
              <li>Complete flow diagrams for all authentication paths</li>
              <li>
                Detailed component documentation with all props, methods, and
                callbacks
              </li>
              <li>State variable explanations with initialization values</li>
              <li>API endpoint documentation with request/response examples</li>
              <li>Error handling for every error code</li>
              <li>Edge cases and special scenarios</li>
              <li>Code examples and implementation details</li>
            </ul>
          </div>

          <h3>Application Overview</h3>
          <p>
            The Zest React Authentication application is a
            <strong>complete migration</strong> from Angular to React,
            maintaining <strong>100% feature parity</strong> and
            <strong>pixel-perfect visual consistency</strong> with the Angular
            version.
          </p>

          <div class="success">
            <h4>Migration Status</h4>
            <ul>
              <li>
                <span class="badge badge-success">Complete</span> All components
                migrated
              </li>
              <li>
                <span class="badge badge-success">Complete</span> All services
                implemented
              </li>
              <li>
                <span class="badge badge-success">Complete</span> All flows
                working
              </li>
              <li>
                <span class="badge badge-success">Complete</span> Error handling
                implemented
              </li>
              <li>
                <span class="badge badge-success">Complete</span> Tracking
                integrated
              </li>
            </ul>
          </div>

          <h4>Technology Stack</h4>
          <table>
            <thead>
              <tr>
                <th>Technology</th>
                <th>Version</th>
                <th>Purpose</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><strong>React</strong></td>
                <td>18+</td>
                <td>UI framework with hooks and functional components</td>
              </tr>
              <tr>
                <td><strong>TypeScript</strong></td>
                <td>5+</td>
                <td>Type-safe JavaScript with interfaces and types</td>
              </tr>
              <tr>
                <td><strong>React Router</strong></td>
                <td>6+</td>
                <td>Client-side routing and navigation</td>
              </tr>
              <tr>
                <td><strong>Groot UI</strong></td>
                <td>Custom</td>
                <td>
                  Internal component library (GtModal, GtInput, GtButton, etc.)
                </td>
              </tr>
              <tr>
                <td><strong>Materialize CSS</strong></td>
                <td>1.0</td>
                <td>Base CSS framework for styling</td>
              </tr>
              <tr>
                <td><strong>react-otp-input</strong></td>
                <td>Latest</td>
                <td>OTP input component with 6-digit support</td>
              </tr>
              <tr>
                <td><strong>react-input-mask</strong></td>
                <td>Latest</td>
                <td>Mobile number input masking</td>
              </tr>
            </tbody>
          </table>
        </section>

        <!-- 2. ARCHITECTURE -->
        <section id="architecture">
          <h2>2. Application Architecture</h2>

          <div class="box">
            <h3>Component Hierarchy</h3>
            <div class="step">
              <strong>App.tsx</strong> → <strong>RedirectComponent</strong> →
              <strong>PhoneNumberSignInV3Complete</strong> →
              <strong>EnterMobileNumberV3</strong> /
              <strong>EnterOtpV3</strong> / <strong>Email Form</strong>
            </div>
          </div>

          <h3>Directory Structure</h3>
          <div class="code-block">
            src/ ├── components/ │ ├── auth/ # Authentication components │ │ ├──
            RedirectComponent/ # Main router │ │ ├──
            PhoneNumberSignInV3Complete/ # Main orchestrator │ │ ├──
            EnterMobileNumberV3/ # Mobile input │ │ ├── EnterOtpV3/ # OTP modal
            │ │ ├── AuthError/ # Error modal │ │ ├── EmailTypoSuggestion/ #
            Email typo helper │ │ ├── PANForm/ # PAN input │ │ ├──
            WhatsAppConsentSlider/ # WhatsApp toggle │ │ ├── SubmitterComponent/
            # Submit button + consent │ │ ├── FinoramicCallback/ # Finoramic
            OAuth callback │ │ ├── ForgotPassword/ # Password reset │ │ └──
            Logout/ # Logout screen │ ├── forms/ # Form components │ │ ├──
            EnterMobileNumberV3/ │ │ └── EnterOtpV3/ │ └── groot/ # Groot UI
            components │ ├── GtModal/ │ ├── GtInput/ │ ├── GtButton/ │ ├──
            GtHeader/ │ ├── GtCheckbox/ │ └── GtSwipe/ ├── services/ # Business
            logic services │ ├── authenticationServiceExtended.ts │ ├──
            applicationService.ts │ ├── trackingService.ts │ ├──
            backendService.ts │ ├── loaderService.ts │ ├── headerService.ts │
            └── footerService.ts ├── types/ # TypeScript types │ └──
            contracts.ts ├── utils/ # Helper functions │ ├── helpers.ts │ ├──
            errorHandling.ts │ └── sessionStorage.ts └── App.tsx # Root
            component
          </div>
        </section>

        <!-- 3. ENTRY POINTS -->
        <section id="entry-points">
          <h2>3. Entry Points & Routing</h2>

          <div class="box">
            <h3>App.tsx Entry Point</h3>
            <p>
              When the application loads, <code>App.tsx</code> performs
              initialization:
            </p>
            <ul>
              <li>Environment Manager validates configuration</li>
              <li>Performance Service sets up caching strategies</li>
              <li>Error Handling initializes error logging</li>
              <li>Analytics services (WebEngage, MoEngage) initialize</li>
              <li>HTML font size set to 16px (matching Angular)</li>
            </ul>
          </div>

          <h3>RedirectComponent Decision Tree</h3>
          <div class="step">
            <span class="step-num">1</span>
            <strong>Check: isLogout?</strong> → YES →
            <strong>Logout Component</strong>
          </div>
          <div class="step">
            <span class="step-num">2</span>
            <strong>Check: resetPasswordToken?</strong> → YES →
            <strong>ForgotPassword Component</strong>
          </div>
          <div class="step">
            <span class="step-num">3</span>
            <strong>Check: URL contains '/finoramic-callback'?</strong> → YES →
            <strong>FinoramicCallback Component</strong>
          </div>
          <div class="step">
            <span class="step-num">4</span>
            <strong>Check: isSignup AND clientName !== 'MyAccounts'?</strong> →
            YES → <strong>PhoneNumberSignUpComplete</strong>
          </div>
          <div class="step">
            <span class="step-num">5</span>
            <strong>DEFAULT</strong> →
            <strong>PhoneNumberSignInV3Complete</strong>
          </div>

          <h4>Entry Point Conditions</h4>
          <table>
            <thead>
              <tr>
                <th>Condition</th>
                <th>Resulting Component</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><code>isLogout = true</code></td>
                <td><strong>Logout</strong></td>
                <td>
                  User is logging out. Shows 5-second countdown and cleanup.
                </td>
              </tr>
              <tr>
                <td><code>resetPasswordToken</code> exists</td>
                <td><strong>ForgotPassword</strong></td>
                <td>
                  Password reset flow. Token extracted from URL query params.
                </td>
              </tr>
              <tr>
                <td>
                  <code>isSignup = true</code> AND
                  <code>clientName !== 'MyAccounts'</code>
                </td>
                <td><strong>PhoneNumberSignUpComplete</strong></td>
                <td>Signup flow for non-MyAccounts clients.</td>
              </tr>
              <tr>
                <td>Default</td>
                <td><strong>PhoneNumberSignInV3Complete</strong></td>
                <td>Main login flow. Most common entry point.</td>
              </tr>
              <tr>
                <td>URL contains <code>/finoramic-callback</code></td>
                <td><strong>FinoramicCallback</strong></td>
                <td>Finoramic OAuth callback handler.</td>
              </tr>
            </tbody>
          </table>
        </section>

        <!-- 4. MAIN FLOW -->
        <section id="main-flow">
          <h2>4. Main Authentication Flow</h2>

          <div class="box">
            <h3>PhoneNumberSignInV3Complete Component</h3>
            <p>
              <strong>Location:</strong>
              <code
                >src/components/auth/PhoneNumberSignInV3Complete/index.tsx</code
              >
            </p>
            <p><strong>Lines of Code:</strong> ~1,300 lines</p>
            <p>
              <strong>Purpose:</strong> Main orchestrator component that manages
              the complete authentication journey from mobile entry to
              successful authentication.
            </p>
          </div>

          <h4>Complete Props Interface</h4>
          <div class="code-block">
            export interface PhoneNumberSignInV3Props { // Environment &
            Configuration environment?: string; // Default: 'Local' clientName?:
            string; // Client identifier getEnvironmentConfig?: (envType:
            string) => any; // Merchant & Application IDs loanApplicationId?:
            string; merchantId?: string; MerchantCustomerId?: string;
            merchantKey?: string; // Feature Flags showTruecaller?: boolean;
            showGetCallFeatureSwitch?: boolean; hideGmail?: boolean;
            googlePayRedirection?: boolean; newTexts?: boolean; isReferred?:
            boolean; // Auto Signup/Login autoSignupCustomer?:
            AutoSignupCustomer; checkoutParams?: any; // Error Handling
            authError?: AuthError; // Service Injections authService?:
            AuthenticationServiceExtended; applicationService?:
            ApplicationService; trackingService?: TrackingService;
            loaderService?: LoaderService; // Callbacks onGetToken?: (token:
            Token) => void; onGetEvents?: (events: EventDetails[]) => void; }
          </div>

          <h4>Complete State Variables (All 30+)</h4>
          <table>
            <thead>
              <tr>
                <th>State Variable</th>
                <th>Type</th>
                <th>Initial Value</th>
                <th>Purpose</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><code>authentication</code></td>
                <td>Authentication</td>
                <td><code>new Authentication()</code></td>
                <td>
                  Main auth object containing MobileNumber, Email, Otp, OtpId,
                  etc.
                </td>
              </tr>
              <tr>
                <td><code>showOtpForm</code></td>
                <td>boolean</td>
                <td><code>false</code></td>
                <td>Controls OTP modal visibility</td>
              </tr>
              <tr>
                <td><code>showEmailOptions</code></td>
                <td>boolean</td>
                <td><code>false</code></td>
                <td>Controls email entry form visibility</td>
              </tr>
              <tr>
                <td><code>showFinoramicParsing</code></td>
                <td>boolean</td>
                <td><code>false</code></td>
                <td>Controls Gmail parsing feature visibility</td>
              </tr>
              <tr>
                <td><code>isPanForm</code></td>
                <td>boolean</td>
                <td><code>false</code></td>
                <td>Controls PAN input visibility (MFA Challenge)</td>
              </tr>
              <tr>
                <td><code>emailAvailable</code></td>
                <td>boolean</td>
                <td><code>false</code></td>
                <td>Indicates if email is available for user</td>
              </tr>
              <tr>
                <td><code>showError</code></td>
                <td>boolean</td>
                <td><code>false</code></td>
                <td>Error display state</td>
              </tr>
              <tr>
                <td><code>errorMessage</code></td>
                <td>string</td>
                <td><code>''</code></td>
                <td>Current error message text</td>
              </tr>
              <tr>
                <td><code>sliderCheck</code></td>
                <td>boolean</td>
                <td><code>true</code></td>
                <td>WhatsApp consent toggle state</td>
              </tr>
              <tr>
                <td><code>incomeConsent</code></td>
                <td>boolean</td>
                <td><code>false</code></td>
                <td>Income consent checkbox state</td>
              </tr>
              <tr>
                <td><code>showGetCall</code></td>
                <td>boolean</td>
                <td><code>false</code></td>
                <td>"Get OTP via Call" feature visibility</td>
              </tr>
              <tr>
                <td><code>hasOtpCallFinished</code></td>
                <td>boolean</td>
                <td><code>false</code></td>
                <td>OTP call completion status</td>
              </tr>
              <tr>
                <td><code>isSubmitInProgress</code></td>
                <td>boolean</td>
                <td><code>false</code></td>
                <td>Form submission loading state</td>
              </tr>
              <tr>
                <td><code>retryOtpAttemts</code></td>
                <td>number</td>
                <td><code>0</code></td>
                <td>OTP retry attempt counter</td>
              </tr>
              <tr>
                <td><code>qValue</code></td>
                <td>string</td>
                <td><code>''</code></td>
                <td>PAN value (for MFA Challenge)</td>
              </tr>
              <tr>
                <td><code>enteredEmail</code></td>
                <td>string</td>
                <td><code>''</code></td>
                <td>Email input value</td>
              </tr>
              <tr>
                <td><code>emailErrorMsg</code></td>
                <td>string | null</td>
                <td><code>null</code></td>
                <td>Email validation error message</td>
              </tr>
              <tr>
                <td><code>token</code></td>
                <td>Token | null</td>
                <td><code>null</code></td>
                <td>Authentication token (access_token, refresh_token)</td>
              </tr>
              <tr>
                <td><code>userDetails</code></td>
                <td>UserDetails | null</td>
                <td><code>null</code></td>
                <td>User details object for tracking</td>
              </tr>
              <tr>
                <td><code>disabled</code></td>
                <td>boolean</td>
                <td><code>false</code></td>
                <td>Disables mobile input (for auto signup/login)</td>
              </tr>
              <tr>
                <td><code>otherEmail</code></td>
                <td>boolean</td>
                <td><code>false</code></td>
                <td>Flag for "other email" flow</td>
              </tr>
              <tr>
                <td><code>googleSignup</code></td>
                <td>boolean</td>
                <td><code>false</code></td>
                <td>Flag for Google signup flow</td>
              </tr>
              <tr>
                <td><code>googleIdToken</code></td>
                <td>string</td>
                <td><code>''</code></td>
                <td>Google OAuth ID token</td>
              </tr>
              <tr>
                <td><code>showTimer</code></td>
                <td>boolean</td>
                <td><code>false</code></td>
                <td>OTP timer visibility</td>
              </tr>
              <tr>
                <td><code>timer</code></td>
                <td>number</td>
                <td><code>30</code></td>
                <td>OTP countdown timer (seconds)</td>
              </tr>
              <tr>
                <td><code>isAutoSignupCustomer</code></td>
                <td>boolean</td>
                <td><code>false</code></td>
                <td>Auto signup customer flag</td>
              </tr>
              <tr>
                <td><code>isAutoSignInCustomer</code></td>
                <td>boolean</td>
                <td><code>false</code></td>
                <td>Auto signin customer flag</td>
              </tr>
              <tr>
                <td><code>isGpay</code></td>
                <td>boolean</td>
                <td><code>false</code></td>
                <td>Google Pay iframe detection</td>
              </tr>
              <tr>
                <td><code>googlepayAuthentication</code></td>
                <td>boolean</td>
                <td><code>false</code></td>
                <td>Google Pay authentication flag</td>
              </tr>
              <tr>
                <td><code>environmentType</code></td>
                <td>string</td>
                <td><code>environment prop</code></td>
                <td>Current environment (Local, Staging, Production)</td>
              </tr>
            </tbody>
          </table>

          <h4>Refs Used</h4>
          <table>
            <thead>
              <tr>
                <th>Ref Name</th>
                <th>Type</th>
                <th>Purpose</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><code>generateOtpTimeoutRef</code></td>
                <td><code>useRef&lt;NodeJS.Timeout | null&gt;</code></td>
                <td>Stores timeout ID for debouncing OTP generation</td>
              </tr>
              <tr>
                <td><code>getTokenUsingAcrValuesRef</code></td>
                <td><code>useRef&lt;Function | null&gt;</code></td>
                <td>
                  Stores getTokenUsingAcrValues function reference to avoid
                  hoisting issues
                </td>
              </tr>
              <tr>
                <td><code>authenticationRef</code></td>
                <td><code>useRef&lt;Authentication&gt;</code></td>
                <td>
                  Stores latest authentication state for synchronous access
                  (fixes async state update issues)
                </td>
              </tr>
            </tbody>
          </table>
        </section>
      </div>
    </div>
  </body>
</html>
